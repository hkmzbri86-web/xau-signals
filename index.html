<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>XAU/USD Smart Signal Dashboard</title>
<script src="https://unpkg.com/lightweight-charts@3.6.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
  body { font-family: Arial, sans-serif; background:#0f172a; color:#e6eef8; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
  .container { width:90%; max-width:1200px; padding:20px; }
  h1 { text-align:center; margin-bottom:10px; }
  .signal { font-size:18px; margin:10px 0; padding:12px; border-radius:8px; text-align:center; transition: all 0.5s; }
  .buy { background:#10b981; }
  .sell { background:#ef4444; }
  .neutral { background:#64748b; }
  .risky { border:2px solid #fbbf24; }
  #chart { height:400px; margin-top:20px; border-radius:8px; }
</style>
</head>
<body>
<div class="container">
  <h1>XAU/USD Realtime Signals & Chart</h1>
  <div id="M1" class="signal neutral">Laden…</div>
  <div id="M5" class="signal neutral">Laden…</div>
  <div id="M15" class="signal neutral">Laden…</div>
  <div id="chart"></div>
</div>

<script>
const API_KEY = 'JOUW_FINNHUB_API_KEY_HIER';
const SYMBOL = 'OANDA:XAUUSD';
const TIMEFRAMES = {M1: 1, M5: 5, M15: 15};
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
  width: 1100,
  height: 400,
  layout: {backgroundColor:'#0f172a', textColor:'#e6eef8'},
  grid:{vertLines:{color:'#1e293b'}, horzLines:{color:'#1e293b'}},
});
const candleSeries = chart.addCandlestickSeries();

// Hulpfunctie: haal candle data op van Finnhub
async function fetchCandle(tf) {
  const now = Math.floor(Date.now()/1000);
  const from = now - tf*60*100; // 100 candles terug
  const url = `https://finnhub.io/api/v1/forex/candle?symbol=${SYMBOL}&resolution=${tf}&from=${from}&to=${now}&token=${API_KEY}`;
  const resp = await fetch(url);
  return await resp.json();
}

// Bereken RSI
function calcRSI(closes, period=14){
  let gains=0, losses=0;
  for(let i=1;i<=period;i++){
    const diff = closes[closes.length-i]-closes[closes.length-i-1];
    if(diff>0) gains+=diff; else losses-=diff;
  }
  const RS = gains/losses || 0;
  return 100 - (100/(1+RS));
}

// EMA crossover
function calcEMA(closes, period){
  const k = 2/(period+1);
  let ema = closes[0];
  for(let i=1;i<closes.length;i++){
    ema = closes[i]*k + ema*(1-k);
  }
  return ema;
}

// Signaal logica
function determineSignal(closes){
  const last = closes[closes.length-1];
  const prev = closes[closes.length-2];
  const rsi = calcRSI(closes);
  const emaShort = calcEMA(closes.slice(-20),5);
  const emaLong = calcEMA(closes.slice(-50),20);

  let signal='neutral';
  if(last>prev && emaShort>emaLong && rsi<70) signal='buy';
  else if(last<prev && emaShort<emaLong && rsi>30) signal='sell';
  
  // Voeg risico toe: snelle bewegingen = agressiever
  const changePerc = Math.abs((last-prev)/prev*100);
  const risky = changePerc>0.2;

  return {signal, risky};
}

// Update dashboard
async function updateSignals(){
  for(const [tf,minutes] of Object.entries(TIMEFRAMES)){
    const data = await fetchCandle(minutes);
    if(data.s!=='ok') continue;
    const closes = data.c;
    const sig = determineSignal(closes);
    const div = document.getElementById(tf);
    div.className = 'signal '+sig.signal+(sig.risky?' risky':'');
    const percent = sig.signal==='buy'?70:sig.signal==='sell'?70:50;
    div.innerHTML = `${tf}: ${sig.signal.toUpperCase()} ~${percent}% kans`;
    // Update chart voor M1 als voorbeeld
    if(tf==='M1'){
      const candles = data.t.map((t,i)=>({time:t, open:data.o[i], high:data.h[i], low:data.l[i], close:data.c[i]}));
      candleSeries.setData(candles);
    }
  }
}

// Init
updateSignals();
setInterval(updateSignals, 60*1000); // update elke minuut
</script>
</body>
</html>
